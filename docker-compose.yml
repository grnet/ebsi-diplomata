version: '3.8'

services:
  issuer:
    container_name: ebsi-issuer-dev
    build:
      context: ./web
      dockerfile: Dockerfile.dev
    ports:
      - 7000:7000
    expose:
      - 7000
    environment:
      DEBUG: 1
      HTTP_PORT: 7000
      DATABASE: postgres
      SQL_DATABASE: diplomas_db
      SQL_USER: diplomas_db_user
      SQL_PASSWORD: diplomas_db_password
      SQL_ENGINE: django.db.backends.postgresql
      SQL_HOST: diplomas-db
      SQL_PORT: 5432
      GOOGLE_CLIENT_ID: ${EBSI_DIPLOMAS_GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${EBSI_DIPLOMAS_GOOGLE_CLIENT_SECRET}
      GOOGLE_TOKEN_URL: ${EBSI_DIPLOMAS_GOOGLE_TOKEN_URL}
      GOOGLE_AUTHORIZE_URL: ${EBSI_DIPLOMAS_GOOGLE_AUTHORIZE_URL}
      GOOGLE_API_BASE_URL: ${EBSI_DIPLOMAS_GOOGLE_API_BASE_URL}
      GOOGLE_SERVER_METADATA_URL: ${EBSI_DIPLOMAS_GOOGLE_SERVER_METADATA_URL}
      GOOGLE_SCOPE: ${EBSI_DIPLOMAS_GOOGLE_SCOPE}
    volumes:
      - ./web:/home/dev/app
      - ./storage/issuer:/home/dev/storage
      - ./ssi-lib/commands:/usr/local/sbin
    depends_on:
      - diplomas_postgres
        # verifier:
        #   container_name: ebsi-verifier-dev
        #   build:
        #     context: ./web
        #     dockerfile: Dockerfile.dev
        #   ports:
        #     - 7001:7001
        #   expose:
        #     - 7001
        #   environment:
        #     DEBUG: 1
        #     HTTP_PORT: 7001
        #     DATABASE: postgres
        #     SQL_DATABASE: diplomas_db
        #     SQL_USER: diplomas_db_user
        #     SQL_PASSWORD: diplomas_db_password
        #     SQL_ENGINE: django.db.backends.postgresql
        #     SQL_HOST: diplomas-db
        #     SQL_PORT: 5432
        #   volumes:
        #     - ./web:/home/dev/app
        #     - ./storage/verifier:/home/dev/storage
        #     - ./ssi-lib/commands:/usr/local/sbin
        #   depends_on:
        #     - diplomas_postgres
  diplomas_postgres:
    container_name: diplomas-db
    image: postgres:14.0-alpine
    volumes:
      - diplomas_postgres_data:/var/lib/postgresql/data/
    environment:
      POSTGRES_DB: diplomas_db
      POSTGRES_USER: diplomas_db_user
      POSTGRES_PASSWORD: diplomas_db_password
volumes:
  diplomas_postgres_data:
